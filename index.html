<!DOCTYPE html>
<html>
<head>
    <title>Amugona Chat</title>
    <!-- Bootstrap core CSS -->
    <!-- 합쳐지고 최소화된 최신 CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">

    <!-- 부가적인 테마 -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
    <style>
        body {
            font-family: "나눔바른펜";
            height: 100%;
        }

        .center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .createPage, .namePage, .detailPage, .invitePage, .bangChat{
            display: none;
        }

        /* Input & Button Style */
        input, button {
            padding: 5px 10px;
            height: 30px;
            border: 1px solid #eee;
            border-radius: 7px;
        }

        input {
            width: 220px;
        }

        button {
            width: 140px;
        }

        input:hover {
            border-color: #ccc;
        }

        button:hover {
            background-color: #ccc;
        }

        input:focus, button:focus {
            border-color: #4272bd;
            outline: none;
        }

        /* page */
        .bangPage {
            padding: 10px;
        }

        .form-signin{
            max-width:330px;
            padding:15px;
            margin:0 auto;
        }

        /* 채팅창 스타일시트 */
        .bangChat {
          padding: 5px 10px;
        }
        .nav {
          background-color: #eee;
          height: 900px;
          padding: 5px 10px;
        }
        #inputMessage {
          position: fixed;
          margin-right: 10px;
          width: 83%;
          bottom: 0;
          right: 0;
        }
    </style>

</head>
<body>
    <div class="pages">

        <!-- main page -->
        <div class="mainPage center">
            <h1>Hello World!</h1>
            <form>
              <input id="inputEmail" placeholder="email">
              <button id="btnCreate">Create new Bang</button>
            </form>
        </div>

        <!-- create page -->
        <div class="createPage">

            <!-- bang name -->
            <div class="bangPage">
                <form class="form-signin">
                    <h1>Edit your Bang Name</h1>
                        <input class="form-control" id="inputBangName" type="text" placeholder="BangName">
                        <input class="form-control" id="inputBangAddr" type="text" placeholder="BangAddress">
                        <label>.amugona.com</label>
                    <button id="btnNextToName">Next</button>
                </form>
            </div>

            <!-- name & nickname -->
            <div class="namePage">
                <form class="form-signin">
                    <h1>Edit your name & nickname</h1>
                    <p>
                        your name
           
                        <input class="form-control" id="inputFirstName" type="text" placeholder="first name">
                        <input class="form-control" id="inputLastName" type="text" placeholder="last name">
                    </p>
                    <p>
                        your nickname
           
                        <input class="form-control" id="inputNickName" type="text" placeholder="nickname">
                    </p>
                    <button id="btnNextToDetail">Next</button>
                </form>
            </div>

            <!-- detail -->
            <div class="detailPage">
                <form class="form-signin">
                    <h1>Profile Detail</h1>
                    <p>Bang Name</p>
                    <input class="form-control" id="editBangName" placeholder="bang name">
                    <p>Bang Address</p>
                    <input class="form-control" id="editBangAddr" placeholder="bang address">
                    <p>Name</p>
                    <input class="form-control" id="editName" placeholder="name">
                    <p>nickName</p>
                    <input class="form-control" id="editNickName" placeholder="nickname">
                    <p>Email</p>
                    <input class="form-control" id="editEmail" placeholder="email">
                    <button>Create</button>
                </form>
            </div>


            <div class="invitePage">
                <div class="container">
                    <form class="form-signin">
                        <h1 class="form-signin-heading">방에 초대하기</h1>

                        <input type="email" id="inputInviteEmail1" class="form-control" placeholder="Email address1" required autofocus>
                        <input type="email" id="inputInviteEmail2" class="form-control" placeholder="Email address2" required>
                        <input type="email" id="inputInviteEmail3" class="form-control" placeholder="Email address3" required>

                        <button class="btn btn-lg btn-primary btn-block" id="btnInvteLater">나중에</button>
                        <button class="btn btn-lg btn-primary btn-block" type="submit">초대하기</button>

                    </form>

                </div>
            </div>
        </div>

        <!-- Chat Room -->
        <div class="bangChat">
            <div class="row">
              <div class="col-md-2">
                <ul class="nav">
                  <li>방이름</li>
                  <li>칸막이</li>
                  <li>유저</li>
                </ul>
              </div>
              <div class="col-md-10">
                <!-- 칸막이 정보 -->
                <div class="head">
                  <h1 class="header">
                    칸막이이름<br>
                    <small>멤버수</small>
                    <small>칸막이설명</small>
                  </h1>
                  <hr>
                </div>

                <!-- 채팅창 -->
                <div class="Chat">
                  <ul id="messages"></ul>
                  <input type="text" id="inputMessage" placeholder="type here...">
                </div>
              </div>
            </div>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <script>
        var $window = $(window);
        var $inputEmail = $('#inputEmail');
        var $inputBangName = $('#inputBangName');
        var $inputBangAddr = $('#inputBangAddr');
        var $inputFirstName = $('#inputFirstName');
        var $inputLastName = $('#inputLastName');
        var $inputNickName = $('#inputNickName');

        var $btnInviteLater = $('#btnInvteLater');

        var $editEmail = $('#editEmail');
        var $editBangName = $('#editBangName');
        var $editBangAddr = $('#editBangAddr');
        var $editName = $('#editName');
        var $editNickName = $('#editNickName');

        var BangName;
        var BangAddr;
        var Name;
        var NickName;
        var Email;

        var $mainPage = $('.mainPage');
        var $createPage = $('.createPage');
        var $namePage = $('.namePage');
        var $bangPage = $('.bangPage');
        var $detailPage = $('.detailPage');
        var $invitePage = $('.invitePage');
        var $bangChat = $('.bangChat');

        var $currentInput = $inputEmail.focus();

        var $messages = $('#messages');
        var $inputMessage = $('#inputMessage');
        var page = 0;
        var addedUser = false;

        var socket = io();

        function setUsername() {
          if(addedUser) return;
          else {
            socket.emit('add user', NickName);
          }
        }

        $btnInviteLater.click(function () {   // go to bangChat
            $invitePage.fadeOut();
            $bangChat.show();
            setUsername();
        })

        $window.keydown(function (event) {
            if (!(event.ctrlKey || event.metaKey || event.altKey)) {
                $currentInput.focus();
            }

            if (event.which === 13) {
                if(addedUser) {   // 접속

                } else {    // 비 접속
                  switch (page) {
                      case 0: // email
                          Email = $inputEmail.val();

                          $mainPage.fadeOut();
                          $createPage.show();
                          break;
                      case 1: // bang
                          BangName = $inputBangName.val();
                          BangAddr = $inputBangAddr.val();

                          $namePage.show();
                          $bangPage.fadeOut();
                          break;
                      case 2: // name
                          NickName = $inputNickName.val();

                          // set input
                          $editEmail.val(Email);
                          $editBangName.val(BangName);
                          $editBangAddr.val(BangAddr + '.amugona.com');
                          $editName.val($inputFirstName.val() + $inputLastName.val());
                          $editNickName.val($inputNickName.val());

                          $detailPage.show();
                          $namePage.fadeOut();
                          break;
                      case 3: // detail
                          $detailPage.fadeOut();
                          $invitePage.show();
                          break;
                      default:
                          break;
                  }
                  page++;
              }
            }
        });

        // socket event
        socket.on('user joined', function(data) {
          $messages.append($('<li>').text(data.username + "님이 접속하셨습니다."));
        });
  </script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>
    <!-- 합쳐지고 최소화된 최신 자바스크립트 -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
</body>
</html>
